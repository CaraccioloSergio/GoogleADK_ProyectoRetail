{% extends "admin_base.html" %}
{% block title %}Carritos - Admin{% endblock %}
{% block content %}
<h2>Carritos</h2>

<!-- Indicador de búsqueda activa -->
{% if q_user or q_email or q_status %}
<div class="search-active-indicator">
  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <circle cx="11" cy="11" r="8"></circle>
    <path d="m21 21-4.35-4.35"></path>
  </svg>
  <span>Búsqueda activa</span>
  <a href="/admin/carts" class="btn-back" style="margin-left: auto;">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M19 12H5M12 19l-7-7 7-7"/>
    </svg>
    Ver todos
  </a>
</div>
{% endif %}

<!-- Botón para mostrar/ocultar buscador -->
<button class="search-toggle" onclick="toggleSearch('cartSearch')">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <circle cx="11" cy="11" r="8"></circle>
    <path d="m21 21-4.35-4.35"></path>
  </svg>
  Buscar carritos
</button>

<!-- Buscador colapsable -->
<div id="cartSearch" class="search-bar collapsed">
  <h3>
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="8"></circle>
      <path d="m21 21-4.35-4.35"></path>
    </svg>
    Filtrar carritos
  </h3>
  <form method="get" action="/admin/carts" class="search-form">
    <input type="text" name="q_user" placeholder="Usuario" value="{{ q_user or '' }}">
    <input type="email" name="q_email" placeholder="Email" value="{{ q_email or '' }}">
    <input type="text" name="q_status" placeholder="Estado" value="{{ q_status or '' }}">
    <div class="search-actions">
      <button type="submit" class="btn-search">Buscar</button>
      <a href="/admin/carts" class="btn-clear">Limpiar</a>
    </div>
  </form>
</div>

<table class="table">
  <thead>
    <tr>
      <th>ID</th>
      <th>Usuario</th>
      <th>Email</th>
      <th>Estado</th>
      <th>Items</th>
      <th>Total</th>
      <th>Creado</th>
      <th>Actualizado</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for c in carts %}
    <tr>
      <td><a href="/admin/carts/{{ c.id }}">#{{ c.id }}</a></td>
      <td>{{ c.user_name }}</td>
      <td>{{ c.user_email }}</td>
      <td>
        {% if c.status == 'active' or c.status == 'open' %}
          <span class="badge badge-success">{{ c.status }}</span>
        {% elif c.status == 'pending' %}
          <span class="badge badge-warning">{{ c.status }}</span>
        {% else %}
          <span class="badge badge-neutral">{{ c.status }}</span>
        {% endif %}
      </td>
      <td>{{ c.items_count }}</td>
      <td>${{ "%.2f"|format(c.total) }}</td>
      <td>{{ c.created_at }}</td>
      <td>{{ c.updated_at }}</td>
      <td>
        <div class="action-buttons">
          <a href="/admin/carts/{{ c.id }}/edit" class="btn-icon btn-edit" title="Editar">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
          </a>
          <form method="post" action="/admin/carts/{{ c.id }}/delete" style="display: inline;" onsubmit="return confirm('¿Eliminar este carrito?')">
            <button type="submit" class="btn-icon btn-delete" title="Eliminar">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
            </button>
          </form>
        </div>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
function toggleSearch(id) {
  const searchBar = document.getElementById(id);
  searchBar.classList.toggle('collapsed');
}
</script>
{% endblock %}